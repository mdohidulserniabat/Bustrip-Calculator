<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Bus Trip Hisab - Multi Route By Md Ohidul</title>
<!-- Excel Export Library -->
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<!-- PDF Export Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
  :root {
    --primary: #1976d2;
    --primary-dark: #0d47a1;
    --secondary: #f57c00;
    --success: #2e7d32;
    --danger: #c62828;
    --purple: #6a1b9a;
    --teal: #00796b;
    --indigo: #303f9f;
    --light-bg: #f5f7fa;
    --card-bg: #ffffff;
    --text: #333333;
    --text-light: #666666;
    --border: #e0e0e0;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
    --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--light-bg);
    color: var(--text);
    line-height: 1.4;
    font-size: 14px;
    padding: 15px;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
  }

  .header {
    background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
    color: white;
    padding: 20px 25px;
    border-radius: 16px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
    border-left: 8px solid #ff9800;
  }

  .header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 180px;
    height: 180px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: 50%;
    transform: translate(30%, -30%);
  }

  .header h1 {
    margin: 0;
    font-size: 26px;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 15px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  .header h1 i {
    font-size: 28px;
    color: #ff9800;
  }

  .header .subtitle {
    margin-top: 8px;
    opacity: 0.9;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header .credit {
    position: absolute;
    bottom: 15px;
    right: 25px;
    font-size: 13px;
    opacity: 0.8;
    background: rgba(255,255,255,0.1);
    padding: 5px 12px;
    border-radius: 20px;
  }

  .card {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,0.1);
    transition: transform 0.2s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 18px;
    margin-bottom: 20px;
  }

  .stat-card {
    padding: 22px;
    border-radius: 12px;
    position: relative;
    overflow: hidden;
    color: white;
    min-height: 100px;
    backdrop-filter: blur(10px);
  }

  .stat-card.barisal {
    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
    border-left: 6px solid #ff9800;
  }

  .stat-card.rangpur {
    background: linear-gradient(135deg, #673ab7 0%, #512da8 100%);
    border-left: 6px solid #4caf50;
  }

  .stat-card.today {
    background: linear-gradient(135deg, #009688 0%, #00796b 100%);
    border-left: 6px solid #ffeb3b;
  }

  .stat-card.all {
    background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
    border-left: 6px solid #ff9800;
  }

  .stat-card .label {
    font-size: 14px;
    opacity: 0.95;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
  }

  .stat-card .value {
    font-size: 32px;
    font-weight: 900;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  .stat-card .icon {
    position: absolute;
    bottom: 15px;
    right: 20px;
    font-size: 40px;
    opacity: 0.3;
  }

  .date-selector {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    padding: 20px;
    background: white;
    border-radius: 12px;
    border: 2px solid #e3f2fd;
  }

  .date-selector label {
    font-weight: 700;
    color: var(--primary);
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .date-selector input[type="date"] {
    padding: 12px 16px;
    border: 2px solid #bbdefb;
    border-radius: 10px;
    font-size: 15px;
    font-family: inherit;
    background: white;
    color: var(--text);
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .date-selector input[type="date"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.15);
  }

  .date-display {
    margin-left: auto;
    font-size: 15px;
    font-weight: 700;
    color: var(--primary);
    padding: 10px 20px;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-radius: 10px;
    min-width: 280px;
    text-align: center;
    border: 2px solid #90caf9;
  }

  .trip-lists {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  @media (max-width: 992px) {
    .trip-lists {
      grid-template-columns: 1fr;
    }
  }

  .road-section {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid var(--border);
    box-shadow: var(--shadow);
  }

  .road-header {
    padding: 18px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
  }

  .road-header.barisal {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-bottom: 3px solid #2196f3;
  }

  .road-header.rangpur {
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
    border-bottom: 3px solid #673ab7;
  }

  .road-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 800;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .road-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .list-container {
    margin: 15px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid var(--border);
  }

  .list-header {
    padding: 14px 16px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
  }

  .list-header h4 {
    margin: 0;
    font-size: 15px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .list-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .trip-list {
    padding: 16px;
    max-height: 280px;
    overflow-y: auto;
    background: white;
  }

  .trip-list::-webkit-scrollbar {
    width: 8px;
  }

  .trip-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  .trip-list::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
    border-radius: 4px;
  }

  .trip-item {
    padding: 12px 15px;
    margin-bottom: 10px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
    font-size: 14px;
  }

  .trip-item:hover {
    transform: translateX(4px);
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(25, 118, 210, 0.15);
  }

  .trip-code {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-weight: 700;
    font-size: 14px;
    color: var(--primary);
    padding: 4px 10px;
    background: rgba(25, 118, 210, 0.1);
    border-radius: 6px;
    border: 1px solid rgba(25, 118, 210, 0.3);
  }

  .serial-number {
    color: var(--text-light);
    font-weight: 700;
    min-width: 35px;
    font-size: 13px;
    background: #f5f5f5;
    padding: 3px 8px;
    border-radius: 5px;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-light);
    font-size: 14px;
  }

  .empty-state i {
    font-size: 42px;
    margin-bottom: 15px;
    opacity: 0.4;
  }

  .empty-state p {
    margin: 0;
  }

  button {
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    font-family: inherit;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 42px;
    letter-spacing: 0.3px;
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
  }

  button:active {
    transform: translateY(0);
  }

  .btn-primary {
    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
    color: white;
  }

  .btn-secondary {
    background: linear-gradient(135deg, #757575 0%, #424242 100%);
    color: white;
  }

  .btn-success {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
  }

  .btn-danger {
    background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
    color: white;
  }

  .btn-warning {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
  }

  .btn-purple {
    background: linear-gradient(135deg, #9c27b0 0%, #6a1b9a 100%);
    color: white;
  }

  .btn-teal {
    background: linear-gradient(135deg, #009688 0%, #00796b 100%);
    color: white;
  }

  .btn-indigo {
    background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%);
    color: white;
  }

  .btn-excel {
    background: linear-gradient(135deg, #217346 0%, #1b5e20 100%);
    color: white;
  }

  .btn-pdf {
    background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
    color: white;
  }

  .btn-small {
    padding: 8px 16px;
    font-size: 13px;
    min-height: 36px;
  }

  .action-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    padding: 20px;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 12px;
    border: 2px solid var(--border);
    margin-bottom: 20px;
  }

  .input-section {
    padding: 20px;
    background: white;
    border-radius: 12px;
    border: 2px solid var(--border);
    margin-bottom: 20px;
  }

  .input-section h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--text);
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f0f0f0;
  }

  textarea, input[type="text"] {
    width: 100%;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 15px;
    font-family: 'Inter', sans-serif;
    margin-bottom: 15px;
    transition: all 0.3s ease;
    resize: vertical;
    font-weight: 500;
  }

  textarea:focus, input[type="text"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.15);
  }

  textarea {
    min-height: 140px;
    font-size: 14px;
    line-height: 1.6;
  }

  .route-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  @media (max-width: 768px) {
    .route-inputs {
      grid-template-columns: 1fr;
    }
  }

  .route-input {
    padding: 20px;
    border-radius: 10px;
    border: 2px solid #e0e0e0;
    background: #fafafa;
    transition: all 0.3s ease;
  }

  .route-input:hover {
    border-color: var(--primary);
    background: #fff;
  }

  .route-input.barisal {
    border-top: 4px solid #2196f3;
  }

  .route-input.rangpur {
    border-top: 4px solid #673ab7;
  }

  .route-label {
    font-size: 16px;
    font-weight: 800;
    margin-bottom: 12px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .input-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #e3e8f0 100%);
    border-radius: 10px;
    border: 2px dashed #b0bec5;
  }

  .note {
    font-size: 13px;
    color: var(--text-light);
    margin-top: 15px;
    padding: 15px;
    background: rgba(25, 118, 210, 0.07);
    border-radius: 10px;
    border-left: 4px solid var(--primary);
    line-height: 1.6;
  }

  .note strong {
    color: var(--primary);
  }

  .status-box {
    padding: 15px 20px;
    border-radius: 10px;
    margin: 15px 0;
    display: none;
    animation: slideIn 0.4s ease;
    font-size: 14px;
    font-weight: 500;
  }

  .status-box.success {
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.1) 100%);
    color: #2e7d32;
    border-left: 4px solid #4caf50;
  }

  .status-box.error {
    background: linear-gradient(135deg, rgba(211, 47, 47, 0.15) 0%, rgba(183, 28, 28, 0.1) 100%);
    color: #b71c1c;
    border-left: 4px solid #d32f2f;
  }

  .status-box.info {
    background: linear-gradient(135deg, rgba(25, 118, 210, 0.15) 0%, rgba(13, 71, 161, 0.1) 100%);
    color: #0d47a1;
    border-left: 4px solid #1976d2;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .export-section {
    padding: 20px;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 12px;
    border: 2px solid var(--border);
    margin-bottom: 20px;
  }

  .export-section h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: var(--text);
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    text-align: center;
    justify-content: center;
  }

  .export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
  }

  .export-card {
    padding: 25px;
    background: white;
    border-radius: 12px;
    border: 2px solid var(--border);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .export-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(90deg, #2196f3 0%, #673ab7 100%);
  }

  .export-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
    box-shadow: 0 10px 25px rgba(25, 118, 210, 0.2);
  }

  .export-card h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
  }

  .export-card p {
    margin: 0 0 15px 0;
    color: var(--text-light);
    font-size: 14px;
    line-height: 1.6;
  }

  .export-features {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }

  .feature-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: var(--text);
  }

  .feature-item i {
    color: var(--success);
    font-size: 12px;
    background: rgba(76, 175, 80, 0.1);
    padding: 5px;
    border-radius: 50%;
  }

  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 800;
    margin-left: 8px;
    letter-spacing: 0.5px;
  }

  .badge-new {
    background: linear-gradient(135deg, #ff4081 0%, #f50057 100%);
    color: white;
  }

  .badge-popular {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
  }

  .icon {
    font-size: 22px;
  }

  .hidden {
    display: none;
  }

  .summary-box {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    border: 2px solid var(--border);
  }

  .summary-box h4 {
    margin: 0 0 15px 0;
    color: var(--text);
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 800;
  }

  .summary-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .summary-stat {
    padding: 12px 15px;
    background: white;
    border-radius: 10px;
    border: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    transition: all 0.3s ease;
  }

  .summary-stat:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .summary-stat .label {
    color: var(--text-light);
    font-weight: 600;
  }

  .summary-stat .value {
    color: var(--text);
    font-weight: 800;
    font-size: 16px;
  }

  .progress-container {
    width: 100%;
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    margin-top: 10px;
    overflow: hidden;
    display: none;
  }

  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #2196f3 0%, #673ab7 100%);
    width: 0%;
    transition: width 0.3s ease;
  }

  .company-name {
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    margin-bottom: 15px;
    padding: 10px;
    background: #f0f8ff;
    border-radius: 8px;
    border: 1px solid #d1e7ff;
  }

  @media (max-width: 768px) {
    body {
      padding: 10px;
      font-size: 13px;
    }
    
    .container {
      padding: 0;
    }
    
    .header {
      padding: 15px;
    }
    
    .header h1 {
      font-size: 20px;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .date-display {
      min-width: auto;
      width: 100%;
      margin-top: 12px;
      margin-left: 0;
    }
    
    .export-options {
      grid-template-columns: 1fr;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .input-actions {
      flex-direction: column;
    }
    
    .summary-stats {
      grid-template-columns: 1fr;
    }
  }

  /* Premium design elements */
  .premium-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(135deg, #ffd700 0%, #ff9800 100%);
    color: #333;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 900;
    letter-spacing: 1px;
    text-transform: uppercase;
    box-shadow: 0 3px 8px rgba(255, 152, 0, 0.3);
  }

  .glow-effect {
    box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
  }

  .route-badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 15px;
    font-size: 11px;
    font-weight: 800;
    margin-left: 8px;
  }

  .badge-barisal {
    background: #2196f3;
    color: white;
  }

  .badge-rangpur {
    background: #673ab7;
    color: white;
  }
</style>
<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Inter Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- JetBrains Mono for Code -->
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-bus-alt"></i> Bus Trip Hisab - Multi Route</h1>
    <div class="subtitle">
      <i class="fas fa-map-marker-alt"></i> Dhaka - Barisal & Dhaka - Rangpur Routes
    </div>
    <div class="credit">Developed by Md Ohidul Islam</div>
  </div>

  <div class="company-name">
    <i class="fas fa-building"></i> Ahnaf Transport (Pvt) Ltd
  </div>

  <div class="stats-grid">
    <div class="stat-card barisal">
      <div class="label"><i class="fas fa-route"></i> Barisal Route Trips</div>
      <div class="value" id="barisalCount">0</div>
      <div class="icon"><i class="fas fa-bus"></i></div>
    </div>
    <div class="stat-card rangpur">
      <div class="label"><i class="fas fa-route"></i> Rangpur Route Trips</div>
      <div class="value" id="rangpurCount">0</div>
      <div class="icon"><i class="fas fa-bus-alt"></i></div>
    </div>
    <div class="stat-card today">
      <div class="label"><i class="fas fa-calendar-day"></i> Today's Total</div>
      <div class="value" id="totalCount">0</div>
      <div class="icon"><i class="fas fa-chart-line"></i></div>
    </div>
    <div class="stat-card all">
      <div class="label"><i class="fas fa-database"></i> All Time Total</div>
      <div class="value" id="allTimeCount">0</div>
      <div class="icon"><i class="fas fa-chart-bar"></i></div>
    </div>
  </div>

  <div class="card date-selector">
    <label for="datePicker"><i class="fas fa-calendar-alt"></i> Selected Date:</label>
    <input type="date" id="datePicker" />
    <button onclick="goToToday()" class="btn-primary btn-small"><i class="fas fa-calendar-check"></i> Today</button>
    <div class="date-display" id="currentDateDisplay"></div>
  </div>

  <div id="statusBox" class="status-box"></div>

  <div class="export-section">
    <h3><i class="fas fa-file-export"></i> Export Professional Reports</h3>
    <div class="export-options">
      <div class="export-card">
        <div class="premium-badge">Premium</div>
        <h4><i class="fas fa-file-excel"></i> Export to Excel <span class="badge badge-popular">Most Popular</span></h4>
        <p>Export both routes data to Excel with professional formatting, headers, and summary statistics.</p>
        <div class="export-features">
          <div class="feature-item"><i class="fas fa-check-circle"></i> Two routes in separate sheets</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Company header with branding</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Color-coded trip categories</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Summary statistics included</div>
        </div>
        <button onclick="exportToExcel()" class="btn-excel"><i class="fas fa-file-excel"></i> Export Excel Report</button>
        <div class="progress-container" id="excelProgress">
          <div class="progress-bar" id="excelProgressBar"></div>
        </div>
      </div>
      <div class="export-card">
        <div class="premium-badge">Premium</div>
        <h4><i class="fas fa-file-pdf"></i> Export to PDF <span class="badge badge-new">Professional</span></h4>
        <p>Generate professional PDF report with both routes, compact design and detailed summaries.</p>
        <div class="export-features">
          <div class="feature-item"><i class="fas fa-check-circle"></i> Both routes in one document</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Company branding header</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Detailed route summaries</div>
          <div class="feature-item"><i class="fas fa-check-circle"></i> Compact professional layout</div>
        </div>
        <button onclick="exportToPDF()" class="btn-pdf"><i class="fas fa-file-pdf"></i> Export PDF Report</button>
        <div class="progress-container" id="pdfProgress">
          <div class="progress-bar" id="pdfProgressBar"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="trip-lists">
    <div class="road-section">
      <div class="road-header barisal">
        <h3><i class="fas fa-route" style="color: #2196f3;"></i> Dhaka - Barisal Route</h3>
        <div class="road-actions">
          <button onclick="copyRoute('barisal')" class="btn-primary btn-small"><i class="fas fa-copy"></i> Copy All</button>
          <button onclick="clearRoute('barisal')" class="btn-danger btn-small"><i class="fas fa-trash"></i> Clear Route</button>
        </div>
      </div>
      <div class="list-container">
        <div class="list-header">
          <h4><i class="fas fa-bus" style="color: #2196f3;"></i> Barisal Jor Trips <span class="route-badge badge-barisal">JOR</span></h4>
          <div class="list-actions">
            <button onclick="copyList('barisal', 'jor')" class="btn-primary btn-small"><i class="fas fa-copy"></i> Copy</button>
            <button onclick="clearList('barisal', 'jor')" class="btn-danger btn-small"><i class="fas fa-times"></i> Clear</button>
          </div>
        </div>
        <div class="trip-list" id="barisalJorList">
          <!-- Barisal jor trips will be loaded here -->
        </div>
      </div>
      <div class="list-container">
        <div class="list-header">
          <h4><i class="fas fa-bus-alt" style="color: #f57c00;"></i> Barisal Bijor Trips <span class="route-badge badge-barisal">BIJOR</span></h4>
          <div class="list-actions">
            <button onclick="copyList('barisal', 'bijor')" class="btn-warning btn-small"><i class="fas fa-copy"></i> Copy</button>
            <button onclick="clearList('barisal', 'bijor')" class="btn-danger btn-small"><i class="fas fa-times"></i> Clear</button>
          </div>
        </div>
        <div class="trip-list" id="barisalBijorList">
          <!-- Barisal bijor trips will be loaded here -->
        </div>
      </div>
    </div>

    <div class="road-section">
      <div class="road-header rangpur">
        <h3><i class="fas fa-route" style="color: #673ab7;"></i> Dhaka - Rangpur Route</h3>
        <div class="road-actions">
          <button onclick="copyRoute('rangpur')" class="btn-purple btn-small"><i class="fas fa-copy"></i> Copy All</button>
          <button onclick="clearRoute('rangpur')" class="btn-danger btn-small"><i class="fas fa-trash"></i> Clear Route</button>
        </div>
      </div>
      <div class="list-container">
        <div class="list-header">
          <h4><i class="fas fa-bus" style="color: #673ab7;"></i> Rangpur Jor Trips <span class="route-badge badge-rangpur">JOR</span></h4>
          <div class="list-actions">
            <button onclick="copyList('rangpur', 'jor')" class="btn-purple btn-small"><i class="fas fa-copy"></i> Copy</button>
            <button onclick="clearList('rangpur', 'jor')" class="btn-danger btn-small"><i class="fas fa-times"></i> Clear</button>
          </div>
        </div>
        <div class="trip-list" id="rangpurJorList">
          <!-- Rangpur jor trips will be loaded here -->
        </div>
      </div>
      <div class="list-container">
        <div class="list-header">
          <h4><i class="fas fa-bus-alt" style="color: #f57c00;"></i> Rangpur Bijor Trips <span class="route-badge badge-rangpur">BIJOR</span></h4>
          <div class="list-actions">
            <button onclick="copyList('rangpur', 'bijor')" class="btn-warning btn-small"><i class="fas fa-copy"></i> Copy</button>
            <button onclick="clearList('rangpur', 'bijor')" class="btn-danger btn-small"><i class="fas fa-times"></i> Clear</button>
          </div>
        </div>
        <div class="trip-list" id="rangpurBijorList">
          <!-- Rangpur bijor trips will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <div class="action-buttons">
    <button onclick="copyAllRoutes()" class="btn-success"><i class="fas fa-copy"></i> Copy All Routes</button>
    <button onclick="clearCurrentDate()" class="btn-danger"><i class="fas fa-calendar-times"></i> Clear Current Date</button>
    <button onclick="clearAllData()" class="btn-danger"><i class="fas fa-database"></i> Clear All Data</button>
  </div>

  <div class="summary-box">
    <h4><i class="fas fa-chart-pie"></i> Current Date Summary</h4>
    <div class="summary-stats">
      <div class="summary-stat">
        <span class="label">Barisal Jor Trips:</span>
        <span class="value" id="summaryBarisalJor">0</span>
      </div>
      <div class="summary-stat">
        <span class="label">Barisal Bijor Trips:</span>
        <span class="value" id="summaryBarisalBijor">0</span>
      </div>
      <div class="summary-stat">
        <span class="label">Rangpur Jor Trips:</span>
        <span class="value" id="summaryRangpurJor">0</span>
      </div>
      <div class="summary-stat">
        <span class="label">Rangpur Bijor Trips:</span>
        <span class="value" id="summaryRangpurBijor">0</span>
      </div>
    </div>
  </div>

  <div class="input-section">
    <h3><i class="fas fa-paste"></i> Paste Bulk Text for Both Routes</h3>
    <div class="company-name">
      <i class="fas fa-building"></i> Ahnaf Transport (Pvt) Ltd - Separate Routes Processing
    </div>
    
    <div class="route-inputs">
      <div class="route-input barisal">
        <div class="route-label">
          <i class="fas fa-map-marker-alt" style="color: #2196f3;"></i>
          Dhaka - Barisal Road Content
        </div>
        <textarea id="bulkBarisal" rows="8" placeholder="Paste the full page content for Dhaka-Barisal route here..."></textarea>
      </div>
      
      <div class="route-input rangpur">
        <div class="route-label">
          <i class="fas fa-map-marker-alt" style="color: #673ab7;"></i>
          Dhaka - Rangpur Road Content
        </div>
        <textarea id="bulkRangpur" rows="8" placeholder="Paste the full page content for Dhaka-Rangpur route here..."></textarea>
      </div>
    </div>
    
    <div class="input-actions">
      <button onclick="processBothRoutes()" class="btn-primary glow-effect"><i class="fas fa-cogs"></i> Process Both Routes</button>
      <button onclick="clearInputs()" class="btn-danger"><i class="fas fa-times"></i> Clear Inputs</button>
    </div>
    
    <div class="note">
      <strong><i class="fas fa-info-circle"></i> Note:</strong> 
      Extract coach numbers like <code>06-PK-MA</code>, <code>01 MA-PK</code>, <code>103 CHA SWK</code>, <code>454-MTB-GPL-GBT</code>. 
      Seats â‰¥34 are considered closed and omitted. Each route will be processed separately.
    </div>
  </div>

  <div class="input-section">
    <h3><i class="fas fa-plus-circle"></i> Add Single Trip</h3>
    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: end;">
      <div>
        <input id="singleTrip" type="text" placeholder="e.g. SP 806-PK-MA 05:00 AM or 806-PK-MA" />
      </div>
      <div style="display: flex; gap: 10px;">
        <select id="routeSelect" style="padding: 12px 15px; border-radius: 10px; border: 2px solid #e0e0e0; font-size: 14px; font-weight: 500;">
          <option value="barisal">Barisal Route</option>
          <option value="rangpur">Rangpur Route</option>
        </select>
        <button onclick="addSingleTrip()" class="btn-primary"><i class="fas fa-plus"></i> Add Trip</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Initialize jsPDF ---------- */
const { jsPDF } = window.jspdf;

/* ---------- state ---------- */
const today = new Date().toISOString().split('T')[0];
let data = JSON.parse(localStorage.getItem('tripDataMultiRoute')) || {};
let currentViewDate = today;

/* date picker init */
const datePicker = document.getElementById('datePicker');
const currentDateDisplay = document.getElementById('currentDateDisplay');
datePicker.value = currentViewDate;
datePicker.max = today;
currentDateDisplay.innerText = formatDateDisplay(currentViewDate);

/* status box */
const statusBox = document.getElementById('statusBox');
function showStatus(msg, type = 'info', duration = 3000) {
  statusBox.style.display = 'block';
  statusBox.className = `status-box ${type}`;
  statusBox.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${msg}`;
  
  clearTimeout(showStatus._t);
  showStatus._t = setTimeout(() => {
    statusBox.style.display = 'none';
  }, duration);
}

/* Progress bar functions */
function showProgress(type) {
  const progress = document.getElementById(`${type}Progress`);
  const bar = document.getElementById(`${type}ProgressBar`);
  if (progress && bar) {
    progress.style.display = 'block';
    bar.style.width = '30%';
    setTimeout(() => bar.style.width = '70%', 200);
    setTimeout(() => bar.style.width = '100%', 400);
    setTimeout(() => {
      progress.style.display = 'none';
      bar.style.width = '0%';
    }, 800);
  }
}

/* ---------- utility: format date ---------- */
function formatDateDisplay(dateStr) {
  try {
    const d = new Date(dateStr);
    return d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  } catch(e) { return dateStr; }
}

/* ---------- extractor (more flexible) ---------- */
function extractTripCode(text) {
  if(!text) return null;
  text = text.trim();
  let hasSP = false;
  if(/^SP\s+/i.test(text)) {
    hasSP = true;
    text = text.replace(/^SP\s+/i, '').trim();
  }

  const m = text.match(/^(\d{1,4})(?:[\s\-\.]+([A-Z0-9][A-Z0-9\-\s\.]*)?)?/i);
  if(!m) return null;
  const number = m[1];
  let rest = m[2] || '';
  rest = rest.replace(/\./g, ' ').trim().replace(/\s+/g, '-').replace(/-+/g, '-').toUpperCase();
  const code = rest ? `${number}-${rest}` : `${number}`;
  return hasSP ? `SP ${code}` : code;
}

/* ---------- save helpers ---------- */
function save() { 
  localStorage.setItem('tripDataMultiRoute', JSON.stringify(data)); 
}

function ensureDateBucket(date) {
  if(!data[date]) {
    data[date] = {
      barisal: { jor: [], bijor: [], closed: [] },
      rangpur: { jor: [], bijor: [], closed: [] }
    };
  } else {
    if(!data[date].barisal) data[date].barisal = { jor: [], bijor: [], closed: [] };
    if(!data[date].rangpur) data[date].rangpur = { jor: [], bijor: [], closed: [] };
  }
}

/* ---------- add logic ---------- */
function addTripToCurrentDate(text, route) {
  const code = extractTripCode(text);
  if(!code) return { ok: false, reason: 'no_code' };

  ensureDateBucket(currentViewDate);

  const numMatch = code.match(/\d+/);
  if(!numMatch) return { ok: false, reason: 'no_number' };
  const num = parseInt(numMatch[0], 10);
  const side = (num % 2 === 0) ? 'jor' : 'bijor';

  if(data[currentViewDate][route][side].includes(code)) {
    return { ok: false, reason: 'duplicate', code, route, side };
  }

  data[currentViewDate][route][side].push(code);
  save();
  render();
  return { ok: true, code, route, side };
}

function addClosedToCurrentDate(code, route) {
  if(!code) return { ok: false };
  ensureDateBucket(currentViewDate);
  if(!data[currentViewDate][route].closed.includes(code)) {
    data[currentViewDate][route].closed.push(code);
    save();
    return { ok: true };
  }
  return { ok: false, reason: 'duplicate' };
}

/* ---------- bulk processing ---------- */
function processBulk(route, raw) {
  if(!raw || raw.trim() === '') { 
    return { added: 0, duplicates: 0, errors: 0, omittedClosed: 0, parsed: 0 };
  }

  const parts = raw.split(/Coach No/i);
  let added = 0, duplicates = 0, errors = 0, omittedClosed = 0, parsed = 0;

  for(const seg of parts) {
    const s = seg.trim();
    if(!s) continue;

    const lines = s.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
    if(lines.length === 0) continue;
    let coachCandidate = lines[0];

    coachCandidate = coachCandidate.replace(/\.+$/, '').trim();

    let seats = null;
    const seatsMatch1 = s.match(/Seats\s*[:\s]*\r?\n\s*(\d{1,3})/i);
    const seatsMatch2 = s.match(/Seats\s*[:\s]*([0-9]{1,3})/i);
    if(seatsMatch1) seats = parseInt(seatsMatch1[1], 10);
    else if(seatsMatch2) seats = parseInt(seatsMatch2[1], 10);

    const norm = extractTripCode(coachCandidate);
    if(!norm) {
      errors++;
      continue;
    }
    parsed++;

    if(seats !== null && seats >= 34) {
      addClosedToCurrentDate(norm, route);
      omittedClosed++;
      continue;
    }

    const res = addTripToCurrentDate(norm, route);
    if(res.ok) added++;
    else if(res.reason === 'duplicate') duplicates++;
    else errors++;
  }

  return { added, duplicates, errors, omittedClosed, parsed };
}

function processBothRoutes() {
  const rawBarisal = document.getElementById('bulkBarisal').value.trim();
  const rawRangpur = document.getElementById('bulkRangpur').value.trim();

  if(!rawBarisal && !rawRangpur) { 
    showStatus('Please paste content in at least one route', 'error'); 
    return; 
  }

  const resultBarisal = processBulk('barisal', rawBarisal);
  const resultRangpur = processBulk('rangpur', rawRangpur);

  document.getElementById('bulkBarisal').value = '';
  document.getElementById('bulkRangpur').value = '';

  const totalAdded = resultBarisal.added + resultRangpur.added;
  const totalDuplicates = resultBarisal.duplicates + resultRangpur.duplicates;
  const totalErrors = resultBarisal.errors + resultRangpur.errors;
  const totalOmitted = resultBarisal.omittedClosed + resultRangpur.omittedClosed;

  showStatus(`Processed Both Routes: ${totalAdded} added (Barisal: ${resultBarisal.added}, Rangpur: ${resultRangpur.added}), ${totalDuplicates} duplicates, ${totalOmitted} closed, ${totalErrors} errors`, 'success');
}

/* ---------- single add ---------- */
function addSingleTrip() {
  const txt = document.getElementById('singleTrip').value.trim();
  const route = document.getElementById('routeSelect').value;
  
  if(!txt) { 
    showStatus('Enter a trip first', 'error'); 
    return; 
  }
  const res = addTripToCurrentDate(txt, route);
  if(res.ok) {
    document.getElementById('singleTrip').value = '';
    showStatus(`Added ${res.code} to ${res.route} (${res.side})`, 'success');
  } else if(res.reason === 'duplicate') {
    showStatus(`${res.code} already exists in ${res.route} (${res.side})`, 'error');
  } else {
    showStatus('Could not detect coach number', 'error');
  }
}

/* ---------- render ---------- */
function render() {
  currentDateDisplay.innerText = formatDateDisplay(currentViewDate);

  const barisalJorList = document.getElementById('barisalJorList');
  const barisalBijorList = document.getElementById('barisalBijorList');
  const rangpurJorList = document.getElementById('rangpurJorList');
  const rangpurBijorList = document.getElementById('rangpurBijorList');

  ensureDateBucket(currentViewDate);

  const barisalJor = data[currentViewDate].barisal.jor.slice().sort();
  const barisalBijor = data[currentViewDate].barisal.bijor.slice().sort();
  const rangpurJor = data[currentViewDate].rangpur.jor.slice().sort();
  const rangpurBijor = data[currentViewDate].rangpur.bijor.slice().sort();

  // Barisal Jor
  if(barisalJor.length === 0) {
    barisalJorList.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-bus" style="color: #2196f3;"></i>
        <p>No jor trips for Barisal route</p>
      </div>
    `;
  } else {
    barisalJorList.innerHTML = barisalJor.map((t, i) => `
      <div class="trip-item">
        <div class="serial-number">${i + 1}.</div>
        <div class="trip-code">${t}</div>
        <div style="color: #2196f3; font-weight: 700; font-size: 12px;">BARISAL JOR</div>
      </div>
    `).join('');
  }

  // Barisal Bijor
  if(barisalBijor.length === 0) {
    barisalBijorList.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-bus-alt" style="color: #f57c00;"></i>
        <p>No bijor trips for Barisal route</p>
      </div>
    `;
  } else {
    barisalBijorList.innerHTML = barisalBijor.map((t, i) => `
      <div class="trip-item">
        <div class="serial-number">${i + 1}.</div>
        <div class="trip-code">${t}</div>
        <div style="color: #f57c00; font-weight: 700; font-size: 12px;">BARISAL BIJOR</div>
      </div>
    `).join('');
  }

  // Rangpur Jor
  if(rangpurJor.length === 0) {
    rangpurJorList.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-bus" style="color: #673ab7;"></i>
        <p>No jor trips for Rangpur route</p>
      </div>
    `;
  } else {
    rangpurJorList.innerHTML = rangpurJor.map((t, i) => `
      <div class="trip-item">
        <div class="serial-number">${i + 1}.</div>
        <div class="trip-code">${t}</div>
        <div style="color: #673ab7; font-weight: 700; font-size: 12px;">RANGPUR JOR</div>
      </div>
    `).join('');
  }

  // Rangpur Bijor
  if(rangpurBijor.length === 0) {
    rangpurBijorList.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-bus-alt" style="color: #f57c00;"></i>
        <p>No bijor trips for Rangpur route</p>
      </div>
    `;
  } else {
    rangpurBijorList.innerHTML = rangpurBijor.map((t, i) => `
      <div class="trip-item">
        <div class="serial-number">${i + 1}.</div>
        <div class="trip-code">${t}</div>
        <div style="color: #f57c00; font-weight: 700; font-size: 12px;">RANGPUR BIJOR</div>
      </div>
    `).join('');
  }

  // Update counts
  const barisalTotal = barisalJor.length + barisalBijor.length;
  const rangpurTotal = rangpurJor.length + rangpurBijor.length;
  const totalCount = barisalTotal + rangpurTotal;
  
  document.getElementById('barisalCount').innerText = barisalTotal;
  document.getElementById('rangpurCount').innerText = rangpurTotal;
  document.getElementById('totalCount').innerText = totalCount;

  let allTime = 0;
  Object.keys(data).forEach(d => {
    allTime += (data[d].barisal.jor?.length || 0) + (data[d].barisal.bijor?.length || 0) +
               (data[d].rangpur.jor?.length || 0) + (data[d].rangpur.bijor?.length || 0);
  });
  document.getElementById('allTimeCount').innerText = allTime;

  // Update summary box
  document.getElementById('summaryBarisalJor').innerText = barisalJor.length;
  document.getElementById('summaryBarisalBijor').innerText = barisalBijor.length;
  document.getElementById('summaryRangpurJor').innerText = rangpurJor.length;
  document.getElementById('summaryRangpurBijor').innerText = rangpurBijor.length;
}

/* ---------- Excel Export (Premium Design) ---------- */
function exportToExcel() {
  showProgress('excel');
  
  ensureDateBucket(currentViewDate);
  
  const barisalJor = data[currentViewDate].barisal.jor.slice().sort();
  const barisalBijor = data[currentViewDate].barisal.bijor.slice().sort();
  const rangpurJor = data[currentViewDate].rangpur.jor.slice().sort();
  const rangpurBijor = data[currentViewDate].rangpur.bijor.slice().sort();
  
  if(barisalJor.length === 0 && barisalBijor.length === 0 && 
     rangpurJor.length === 0 && rangpurBijor.length === 0) {
    showStatus('No trips to export for this date', 'error');
    return;
  }

  try {
    // Create workbook
    const wb = XLSX.utils.book_new();
    
    // Barisal Route Sheet
    const maxBarisalRows = Math.max(barisalJor.length, barisalBijor.length);
    const barisalData = [];
    
    // Header with company info
    barisalData.push(['Ahnaf Transport (Pvt) Ltd, Dhaka - Barisal Road']);
    barisalData.push(['Trip Hisab Report - By Md Ohidul Islam']);
    barisalData.push([`Date: ${currentViewDate} (${formatDateDisplay(currentViewDate)})`]);
    barisalData.push(['Generated: ' + new Date().toLocaleString()]);
    barisalData.push(['']); // Empty row
    
    // Table header
    barisalData.push(['SL', 'JOR TRIPS (Barisal Side)', 'BIJOR TRIPS (Dhaka Side)']);
    
    // Table data
    for(let i = 0; i < maxBarisalRows; i++) {
      const row = [
        i + 1,
        barisalJor[i] || '',
        barisalBijor[i] || ''
      ];
      barisalData.push(row);
    }
    
    barisalData.push(['']); // Empty row
    barisalData.push(['SUMMARY STATISTICS', '', '']);
    barisalData.push(['Total Jor Trips (Barisal Side):', barisalJor.length, '']);
    barisalData.push(['Total Bijor Trips (Dhaka Side):', barisalBijor.length, '']);
    barisalData.push(['Total Barisal Route Trips:', barisalJor.length + barisalBijor.length, '']);
    
    const wsBarisal = XLSX.utils.aoa_to_sheet(barisalData);
    wsBarisal['!cols'] = [
      { wch: 8 },  // SL
      { wch: 30 }, // JOR TRIPS
      { wch: 30 }  // BIJOR TRIPS
    ];
    
    // Style header rows
    for(let r = 0; r < 5; r++) {
      for(let c = 0; c < 3; c++) {
        const address = XLSX.utils.encode_cell({r: r, c: c});
        if(!wsBarisal[address]) continue;
        wsBarisal[address].s = {
          font: { bold: true, sz: 11 },
          alignment: { horizontal: "left" }
        };
      }
    }
    
    // Style table header
    const headerRow = 5;
    for(let c = 0; c < 3; c++) {
      const address = XLSX.utils.encode_cell({r: headerRow, c: c});
      if(!wsBarisal[address]) continue;
      wsBarisal[address].s = {
        font: { bold: true, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "2196F3" } },
        alignment: { horizontal: "center" }
      };
    }
    
    // Rangpur Route Sheet
    const maxRangpurRows = Math.max(rangpurJor.length, rangpurBijor.length);
    const rangpurData = [];
    
    // Header with company info
    rangpurData.push(['Ahnaf Transport (Pvt) Ltd, Dhaka - Rangpur Road']);
    rangpurData.push(['Trip Hisab Report - By Md Ohidul Islam']);
    rangpurData.push([`Date: ${currentViewDate} (${formatDateDisplay(currentViewDate)})`]);
    rangpurData.push(['Generated: ' + new Date().toLocaleString()]);
    rangpurData.push(['']); // Empty row
    
    // Table header
    rangpurData.push(['SL', 'JOR TRIPS (Rangpur Side)', 'BIJOR TRIPS (Dhaka Side)']);
    
    // Table data
    for(let i = 0; i < maxRangpurRows; i++) {
      const row = [
        i + 1,
        rangpurJor[i] || '',
        rangpurBijor[i] || ''
      ];
      rangpurData.push(row);
    }
    
    rangpurData.push(['']); // Empty row
    rangpurData.push(['SUMMARY STATISTICS', '', '']);
    rangpurData.push(['Total Jor Trips (Rangpur Side):', rangpurJor.length, '']);
    rangpurData.push(['Total Bijor Trips (Dhaka Side):', rangpurBijor.length, '']);
    rangpurData.push(['Total Rangpur Route Trips:', rangpurJor.length + rangpurBijor.length, '']);
    
    const wsRangpur = XLSX.utils.aoa_to_sheet(rangpurData);
    wsRangpur['!cols'] = [
      { wch: 8 },  // SL
      { wch: 30 }, // JOR TRIPS
      { wch: 30 }  // BIJOR TRIPS
    ];
    
    // Style header rows
    for(let r = 0; r < 5; r++) {
      for(let c = 0; c < 3; c++) {
        const address = XLSX.utils.encode_cell({r: r, c: c});
        if(!wsRangpur[address]) continue;
        wsRangpur[address].s = {
          font: { bold: true, sz: 11 },
          alignment: { horizontal: "left" }
        };
      }
    }
    
    // Style table header
    for(let c = 0; c < 3; c++) {
      const address = XLSX.utils.encode_cell({r: 5, c: c});
      if(!wsRangpur[address]) continue;
      wsRangpur[address].s = {
        font: { bold: true, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "673AB7" } },
        alignment: { horizontal: "center" }
      };
    }
    
    // Summary Sheet
    const summaryData = [];
    summaryData.push(['Ahnaf Transport (Pvt) Ltd - Trip Summary Report']);
    summaryData.push(['Generated by Md Ohidul Islam']);
    summaryData.push([`Date: ${currentViewDate} (${formatDateDisplay(currentViewDate)})`]);
    summaryData.push(['Generated: ' + new Date().toLocaleString()]);
    summaryData.push(['']);
    summaryData.push(['ROUTE SUMMARY', 'JOR TRIPS', 'BIJOR TRIPS', 'TOTAL']);
    summaryData.push([
      'Dhaka - Barisal Route',
      barisalJor.length,
      barisalBijor.length,
      barisalJor.length + barisalBijor.length
    ]);
    summaryData.push([
      'Dhaka - Rangpur Route',
      rangpurJor.length,
      rangpurBijor.length,
      rangpurJor.length + rangpurBijor.length
    ]);
    summaryData.push(['']);
    summaryData.push(['GRAND TOTAL', 
      barisalJor.length + rangpurJor.length,
      barisalBijor.length + rangpurBijor.length,
      barisalJor.length + barisalBijor.length + rangpurJor.length + rangpurBijor.length
    ]);
    
    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
    wsSummary['!cols'] = [
      { wch: 30 },
      { wch: 15 },
      { wch: 15 },
      { wch: 15 }
    ];
    
    // Style summary sheet
    for(let r = 0; r < 5; r++) {
      const address = XLSX.utils.encode_cell({r: r, c: 0});
      if(!wsSummary[address]) continue;
      wsSummary[address].s = {
        font: { bold: true, sz: 12 },
        alignment: { horizontal: "center" }
      };
    }
    
    // Style summary table
    const summaryHeader = 5;
    for(let c = 0; c < 4; c++) {
      const address = XLSX.utils.encode_cell({r: summaryHeader, c: c});
      if(!wsSummary[address]) continue;
      wsSummary[address].s = {
        font: { bold: true, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "009688" } },
        alignment: { horizontal: "center" }
      };
    }
    
    // Add sheets to workbook
    XLSX.utils.book_append_sheet(wb, wsSummary, 'Summary');
    XLSX.utils.book_append_sheet(wb, wsBarisal, 'Barisal Route');
    XLSX.utils.book_append_sheet(wb, wsRangpur, 'Rangpur Route');
    
    // Generate Excel file
    const fileName = `Ahnaf_Transport_Trips_${currentViewDate}.xlsx`;
    XLSX.writeFile(wb, fileName);
    
    setTimeout(() => {
      showStatus(`Excel file "${fileName}" downloaded with 3 sheets!`, 'success');
    }, 800);
    
  } catch (error) {
    console.error('Excel export error:', error);
    showStatus('Excel export failed. Please try again.', 'error');
  }
}

/* ---------- PDF Export (Professional & Compact Design - No Empty Space) ---------- */
function exportToPDF() {
  showProgress('pdf');
  
  ensureDateBucket(currentViewDate);
  
  const barisalJor = data[currentViewDate].barisal.jor.slice().sort();
  const barisalBijor = data[currentViewDate].barisal.bijor.slice().sort();
  const rangpurJor = data[currentViewDate].rangpur.jor.slice().sort();
  const rangpurBijor = data[currentViewDate].rangpur.bijor.slice().sort();
  
  if(barisalJor.length === 0 && barisalBijor.length === 0 && 
     rangpurJor.length === 0 && rangpurBijor.length === 0) {
    showStatus('No trips to export for this date', 'error');
    return;
  }

  try {
    // Create PDF document in PORTRAIT mode
    const doc = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a4',
      compress: true
    });

    // Set default font
    doc.setFont("helvetica");
    doc.setFontSize(9);

    // Main Header - Company and Report Info
    doc.setFontSize(16);
    doc.setTextColor(33, 150, 243);
    doc.text('Ahnaf Transport (Pvt) Ltd', 105, 15, { align: 'center' });
    
    doc.setFontSize(12);
    doc.setTextColor(103, 58, 183);
    doc.text('Trip Hisab Report - By Md Ohidul Islam', 105, 22, { align: 'center' });
    
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    doc.text(`Date: ${currentViewDate}`, 20, 32);
    doc.text(`Report: ${formatDateDisplay(currentViewDate)}`, 105, 32, { align: 'center' });
    doc.text(`Generated: ${new Date().toLocaleString()}`, 190, 32, { align: 'right' });
    
    // Separator line
    doc.setDrawColor(33, 150, 243);
    doc.setLineWidth(0.3);
    doc.line(20, 35, 190, 35);
    
    // Overall Trip Summary (Compact)
    doc.setFontSize(12);
    doc.setTextColor(0, 150, 136);
    doc.text('Overall Trip Summary', 20, 42);
    
    // Summary Table (Compact)
    const summaryTableData = [
      [
        'Dhaka - Barisal Route',
        barisalJor.length.toString(),
        barisalBijor.length.toString(),
        (barisalJor.length + barisalBijor.length).toString()
      ],
      [
        'Dhaka - Rangpur Route',
        rangpurJor.length.toString(),
        rangpurBijor.length.toString(),
        (rangpurJor.length + rangpurBijor.length).toString()
      ],
      [
        'GRAND TOTAL',
        (barisalJor.length + rangpurJor.length).toString(),
        (barisalBijor.length + rangpurBijor.length).toString(),
        (barisalJor.length + barisalBijor.length + rangpurJor.length + rangpurBijor.length).toString()
      ]
    ];
    
    doc.autoTable({
      startY: 47,
      head: [['ROUTE', 'JOR TRIPS', 'BIJOR TRIPS', 'TOTAL TRIPS']],
      body: summaryTableData,
      theme: 'grid',
      headStyles: {
        fillColor: [0, 150, 136],
        textColor: [255, 255, 255],
        fontSize: 9,
        fontStyle: 'bold',
        halign: 'center',
        cellPadding: 2
      },
      columnStyles: {
        0: { cellWidth: 50, fontStyle: 'bold' },
        1: { cellWidth: 30, halign: 'center' },
        2: { cellWidth: 30, halign: 'center' },
        3: { cellWidth: 30, halign: 'center', fontStyle: 'bold' }
      },
      styles: {
        fontSize: 8,
        cellPadding: 2,
        overflow: 'linebreak',
        lineColor: [200, 200, 200],
        lineWidth: 0.1,
        minCellHeight: 6
      },
      margin: { top: 2, left: 20, right: 20 },
      didParseCell: function(data) {
        if(data.row.index === 2) { // Grand Total row
          data.cell.styles.fillColor = [225, 245, 254];
          data.cell.styles.fontStyle = 'bold';
        }
        if(data.row.index < 2) { // Route rows
          if(data.column.index === 0) {
            data.cell.styles.fillColor = data.row.index === 0 ? [232, 244, 253] : [243, 229, 245];
          }
        }
      }
    });
    
    let currentY = doc.lastAutoTable.finalY + 8;
    
    // Barisal Route Header
   doc.setFontSize(14);
doc.setTextColor(33, 150, 243);
doc.text('Ahnaf Transport (Pvt) Ltd, Dhaka - Barisal Road', 105, currentY, { align: 'center' });

doc.setFontSize(11);
doc.setTextColor(0, 0, 0);
doc.text('Trip Hisab By Md Ohidul Islam', 105, currentY + 6, { align: 'center' });
    
    currentY += 12;
    
    // Barisal Route Table
    const barisalTableData = [];
    const maxBarisalRows = Math.max(barisalJor.length, barisalBijor.length);
    
    for(let i = 0; i < maxBarisalRows; i++) {
      barisalTableData.push([
        (i + 1).toString(),
        barisalJor[i] || '',
        barisalBijor[i] || ''
      ]);
    }
    
    doc.autoTable({
      startY: currentY,
      head: [['SL', 'JOR TRIPS (Barisal Side)', 'BIJOR TRIPS (Dhaka Side)']],
      body: barisalTableData,
      theme: 'grid',
      headStyles: {
        fillColor: [33, 150, 243],
        textColor: [255, 255, 255],
        fontSize: 8,
        fontStyle: 'bold',
        halign: 'center',
        cellPadding: 2
      },
      columnStyles: {
        0: { cellWidth: 15, halign: 'center' },
        1: { cellWidth: 70, fillColor: [232, 244, 253] },
        2: { cellWidth: 70, fillColor: [255, 243, 224] }
      },
      styles: {
        fontSize: 7,
        cellPadding: 1.5,
        overflow: 'linebreak',
        lineColor: [200, 200, 200],
        lineWidth: 0.1,
        minCellHeight: 5
      },
      margin: { top: 2, left: 20, right: 20 },
      pageBreak: 'auto'
    });
    
    currentY = doc.lastAutoTable.finalY + 5;
    
    // Barisal Summary Box (Compact)
    doc.setFillColor(240, 240, 240);
    doc.roundedRect(20, currentY, 170, 10, 2, 2, 'F');
    
    doc.setFontSize(9);
    doc.setTextColor(33, 150, 243);
    doc.setFont(undefined, 'bold');
    doc.text('BARISAL ROUTE SUMMARY:', 25, currentY + 3);
    
    doc.setFontSize(8);
    doc.setTextColor(0, 0, 0);
    doc.setFont(undefined, 'normal');
    doc.text(`Jor (Barisal Side): ${barisalJor.length}`, 80, currentY + 3);
    doc.text(`Bijor (Dhaka Side): ${barisalBijor.length}`, 120, currentY + 3);
    doc.text(`Total: ${barisalJor.length + barisalBijor.length}`, 160, currentY + 3);
    
    currentY += 15; // Space before next route
    
    // Check if we need new page for Rangpur route
    if (currentY > 260) { // Near bottom of page
      doc.addPage();
      currentY = 20;
    }
    
    // Rangpur Route Header
    doc.setFontSize(14);
doc.setTextColor(103, 58, 183);
doc.text('Ahnaf Transport (Pvt) Ltd, Dhaka - Rangpur Road', 105, currentY, { align: 'center' });

doc.setFontSize(11);
doc.setTextColor(0, 0, 0);
doc.text('Trip Hisab By Md Ohidul Islam', 105, currentY + 6, { align: 'center' });
    
    currentY += 12;
    
    // Rangpur Route Table
    const rangpurTableData = [];
    const maxRangpurRows = Math.max(rangpurJor.length, rangpurBijor.length);
    
    for(let i = 0; i < maxRangpurRows; i++) {
      rangpurTableData.push([
        (i + 1).toString(),
        rangpurJor[i] || '',
        rangpurBijor[i] || ''
      ]);
    }
    
    doc.autoTable({
      startY: currentY,
      head: [['SL', 'JOR TRIPS (Rangpur Side)', 'BIJOR TRIPS (Dhaka Side)']],
      body: rangpurTableData,
      theme: 'grid',
      headStyles: {
        fillColor: [103, 58, 183],
        textColor: [255, 255, 255],
        fontSize: 8,
        fontStyle: 'bold',
        halign: 'center',
        cellPadding: 2
      },
      columnStyles: {
        0: { cellWidth: 15, halign: 'center' },
        1: { cellWidth: 70, fillColor: [243, 229, 245] },
        2: { cellWidth: 70, fillColor: [255, 243, 224] }
      },
      styles: {
        fontSize: 7,
        cellPadding: 1.5,
        overflow: 'linebreak',
        lineColor: [200, 200, 200],
        lineWidth: 0.1,
        minCellHeight: 5
      },
      margin: { top: 2, left: 20, right: 20 },
      pageBreak: 'auto'
    });
    
    currentY = doc.lastAutoTable.finalY + 5;
    
    // Rangpur Summary Box (Compact)
    doc.setFillColor(240, 240, 240);
    doc.roundedRect(20, currentY, 170, 10, 2, 2, 'F');
    
    doc.setFontSize(9);
    doc.setTextColor(103, 58, 183);
    doc.setFont(undefined, 'bold');
    doc.text('RANGPUR ROUTE SUMMARY:', 25, currentY + 3);
    
    doc.setFontSize(8);
    doc.setTextColor(0, 0, 0);
    doc.setFont(undefined, 'normal');
    doc.text(`Jor (Rangpur Side): ${rangpurJor.length}`, 80, currentY + 3);
    doc.text(`Bijor (Dhaka Side): ${rangpurBijor.length}`, 120, currentY + 3);
    doc.text(`Total: ${rangpurJor.length + rangpurBijor.length}`, 160, currentY + 3);
    
    // Footer with page numbers
    const pageCount = doc.internal.getNumberOfPages();
    for(let i = 1; i <= pageCount; i++) {
      doc.setPage(i);
      doc.setFontSize(7);
      doc.setTextColor(150, 150, 150);
      doc.text(`Page ${i} of ${pageCount}`, 105, 287, { align: 'center' });
      doc.text('Ahnaf Transport (Pvt) Ltd - Trip Hisab Report | By Md Ohidul Islam', 105, 290, { align: 'center' });
    }
    
    // Save PDF
    const fileName = `Ahnaf_Transport_Trips_${currentViewDate}.pdf`;
    doc.save(fileName);
    
    setTimeout(() => {
      showStatus(`PDF file "${fileName}" downloaded with ${pageCount} pages!`, 'success');
    }, 800);
    
  } catch (error) {
    console.error('PDF export error:', error);
    showStatus('PDF export failed. Please try again.', 'error');
  }
}

/* ---------- clear functions ---------- */
function clearList(route, type) {
  if(!data[currentViewDate] || !data[currentViewDate][route] || !data[currentViewDate][route][type] || data[currentViewDate][route][type].length === 0) {
    showStatus(`No ${type} trips to clear in ${route} route`, 'error');
    return;
  }
  if(!confirm(`Clear all ${type} trips for ${route} route on ${currentViewDate}?`)) return;
  data[currentViewDate][route][type] = [];
  save(); 
  render(); 
  showStatus(`Cleared ${type} trips from ${route} route`, 'success');
}

function clearRoute(route) {
  if(!data[currentViewDate] || !data[currentViewDate][route] || 
     (data[currentViewDate][route].jor.length + data[currentViewDate][route].bijor.length) === 0) {
    showStatus(`No trips to clear in ${route} route`, 'error'); 
    return;
  }
  if(!confirm(`Clear ALL trips for ${route} route on ${currentViewDate}?`)) return;
  data[currentViewDate][route].jor = [];
  data[currentViewDate][route].bijor = [];
  data[currentViewDate][route].closed = [];
  save(); 
  render(); 
  showStatus(`Cleared ${route} route trips`, 'success');
}

function clearCurrentDate() {
  let total = 0;
  if(data[currentViewDate]) {
    total += (data[currentViewDate].barisal.jor?.length || 0) + (data[currentViewDate].barisal.bijor?.length || 0) +
             (data[currentViewDate].rangpur.jor?.length || 0) + (data[currentViewDate].rangpur.bijor?.length || 0);
  }
  
  if(total === 0) { 
    showStatus('No trips for this date to clear', 'error'); 
    return;
  }
  if(!confirm(`Clear ALL trips for ${currentViewDate}? (${total} trips across both routes)`)) return;
  delete data[currentViewDate];
  save(); 
  render(); 
  showStatus('Cleared all trips for current date', 'success');
}

function clearAllData() {
  let total = 0, dates = Object.keys(data).length;
  Object.keys(data).forEach(d => {
    total += (data[d].barisal.jor?.length || 0) + (data[d].barisal.bijor?.length || 0) +
             (data[d].rangpur.jor?.length || 0) + (data[d].rangpur.bijor?.length || 0);
  });
  if(total === 0) { 
    showStatus('No data to clear', 'error'); 
    return; 
  }
  if(!confirm(`Clear ALL stored data? (${total} trips across ${dates} dates and 2 routes)`)) return;
  data = {};
  save(); 
  render(); 
  showStatus('All data cleared', 'success');
}

/* ---------- date navigation ---------- */
function goToToday() { 
  currentViewDate = today; 
  datePicker.value = today; 
  render(); 
  showStatus('Switched to today', 'success'); 
}

datePicker.addEventListener('change', () => {
  const selected = datePicker.value;
  if(!selected) return;
  if(selected > today) { 
    showStatus('Cannot select future date', 'error'); 
    datePicker.value = currentViewDate; 
    return; 
  }
  currentViewDate = selected;
  render();
});

/* ---------- misc helpers ---------- */
function clearInputs() { 
  document.getElementById('bulkBarisal').value = ''; 
  document.getElementById('bulkRangpur').value = ''; 
  document.getElementById('singleTrip').value = ''; 
  showStatus('All inputs cleared', 'success'); 
}

function copyList(route, type) {
  const arr = data[currentViewDate] ? data[currentViewDate][route][type] : [];
  if(!arr || arr.length === 0) { 
    showStatus(`No ${type} trips to copy in ${route} route`, 'error'); 
    return; 
  }
  const text = arr.join('\n');
  navigator.clipboard.writeText(text).then(() => {
    showStatus(`Copied ${arr.length} ${type} trips from ${route} route`, 'success');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showStatus(`Copied ${arr.length} ${type} trips from ${route} route`, 'success');
  });
}

function copyRoute(route) {
  const j = data[currentViewDate] ? data[currentViewDate][route].jor : [];
  const b = data[currentViewDate] ? data[currentViewDate][route].bijor : [];
  if((!j || j.length === 0) && (!b || b.length === 0)) { 
    showStatus(`Nothing to copy in ${route} route`, 'error'); 
    return; 
  }

  let out = `${route.toUpperCase()} ROUTE - JOR TRIPS:\n`;
  if(j && j.length) out += j.join('\n') + '\n\n';
  out += `${route.toUpperCase()} ROUTE - BIJOR TRIPS:\n`;
  if(b && b.length) out += b.join('\n');

  navigator.clipboard.writeText(out).then(() => {
    showStatus(`Copied all ${route} route trips`, 'success');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = out;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showStatus(`Copied all ${route} route trips`, 'success');
  });
}

function copyAllRoutes() {
  const barisalJ = data[currentViewDate] ? data[currentViewDate].barisal.jor : [];
  const barisalB = data[currentViewDate] ? data[currentViewDate].barisal.bijor : [];
  const rangpurJ = data[currentViewDate] ? data[currentViewDate].rangpur.jor : [];
  const rangpurB = data[currentViewDate] ? data[currentViewDate].rangpur.bijor : [];
  
  if((!barisalJ || barisalJ.length === 0) && (!barisalB || barisalB.length === 0) &&
     (!rangpurJ || rangpurJ.length === 0) && (!rangpurB || rangpurB.length === 0)) { 
    showStatus('Nothing to copy', 'error'); 
    return; 
  }

  let out = '========== BARISAL ROUTE ==========\n\n';
  out += 'JOR TRIPS (Barisal Side):\n';
  if(barisalJ && barisalJ.length) out += barisalJ.join('\n') + '\n\n';
  out += 'BIJOR TRIPS (Dhaka Side):\n';
  if(barisalB && barisalB.length) out += barisalB.join('\n');
  
  out += '\n\n========== RANGPUR ROUTE ==========\n\n';
  out += 'JOR TRIPS (Rangpur Side):\n';
  if(rangpurJ && rangpurJ.length) out += rangpurJ.join('\n') + '\n\n';
  out += 'BIJOR TRIPS (Dhaka Side):\n';
  if(rangpurB && rangpurB.length) out += rangpurB.join('\n');

  navigator.clipboard.writeText(out).then(() => {
    showStatus('Copied all routes trips', 'success');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = out;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showStatus('Copied all routes trips', 'success');
  });
}

/* ---------- initialize ---------- */
(function init() {
  datePicker.value = currentViewDate;
  render();
})();
</script>
</body>
</html>
